{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <div class="flex items-center gap-3">
        <span class="text-3xl">ğŸ“‹</span>
        <div>
            <h1>ëŒ€ë³¸ ê¸°íš</h1>
            <p>ë¶„ì„ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ëŒ€ë³¸ êµ¬ì¡°ë¥¼ ì„¤ê³„í•©ë‹ˆë‹¤</p>
        </div>
    </div>
</div>

<!-- ë¶„ì„ ë°ì´í„° í‘œì‹œ -->
<div id="analysisInfo" class="card mb-6 hidden">
    <h3 class="font-bold text-gray-800 dark:text-white mb-4">ğŸ“Š ë¶„ì„ ë°ì´í„° ê¸°ë°˜</h3>
    <div id="analysisContent"></div>
</div>

<!-- ëŒ€ë³¸ ì„¤ì • -->
<div class="card mb-6">
    <h3 class="font-bold text-gray-800 dark:text-white mb-4">âš™ï¸ ëŒ€ë³¸ ì„¤ì •</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì˜ìƒ ì£¼ì œ</label>
            <input type="text" id="topicInput" class="input-field" placeholder="ì˜ˆ: ì´ˆë³´ìë¥¼ ìœ„í•œ íŒŒì´ì¬ ê°•ì˜">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì˜ìƒ ê¸¸ì´</label>
            <select id="durationSelect" class="input-field">
                <option value="short">ì§§ì€ ì˜ìƒ (5-10ë¶„)</option>
                <option value="medium" selected>ì¤‘ê°„ ì˜ìƒ (10-20ë¶„)</option>
                <option value="long">ê¸´ ì˜ìƒ (20ë¶„ ì´ìƒ)</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">í†¤ì•¤ë§¤ë„ˆ</label>
            <select id="toneSelect" class="input-field">
                <option value="friendly">ì¹œê·¼í•œ</option>
                <option value="professional">ì „ë¬¸ì ì¸</option>
                <option value="humorous">ìœ ë¨¸ëŸ¬ìŠ¤í•œ</option>
                <option value="educational">êµìœ¡ì ì¸</option>
            </select>
        </div>
    </div>
    <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì¶”ê°€ ìš”ì²­ì‚¬í•­</label>
        <textarea id="additionalNotes" class="input-field" rows="3" placeholder="íŠ¹ë³„íˆ í¬í•¨í•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ë‚˜ ìŠ¤íƒ€ì¼ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
    </div>
</div>

<!-- ìƒì„± ë²„íŠ¼ -->
<button onclick="generateStructure()" id="generateBtn" class="w-full btn-primary py-4 flex items-center justify-center gap-3 text-lg mb-6">
    <span>ğŸ¤–</span>
    <span>ëŒ€ë³¸ êµ¬ì¡° ìƒì„±í•˜ê¸°</span>
</button>

<!-- ê²°ê³¼ ì˜ì—­ -->
<div id="resultSection" class="hidden">
    <div class="card">
        <div class="flex items-center justify-between mb-4">
            <h3 class="font-bold text-gray-800 dark:text-white">ğŸ“ ìƒì„±ëœ ëŒ€ë³¸ êµ¬ì¡°</h3>
            <div class="flex gap-2">
                <button onclick="copyStructure()" class="btn-secondary text-sm">ğŸ“‹ ë³µì‚¬</button>
                <button onclick="regenerate()" class="btn-secondary text-sm">ğŸ”„ ë‹¤ì‹œ ìƒì„±</button>
            </div>
        </div>
        <div id="structureContent" class="prose dark:prose-invert max-w-none"></div>

        <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
            <button onclick="goToScriptGen()" class="w-full btn-primary py-4 flex items-center justify-center gap-3 text-lg">
                <span>âœï¸</span>
                <span>ì „ì²´ ëŒ€ë³¸ ìƒì„±í•˜ê¸°</span>
                <span>â†’</span>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let currentStructure = '';

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¶„ì„ ë°ì´í„° í™•ì¸
    document.addEventListener('DOMContentLoaded', () => {
        const analysisData = Utils.storage.get('analysisData');
        if (analysisData && analysisData.video) {
            document.getElementById('analysisInfo').classList.remove('hidden');
            document.getElementById('topicInput').value = analysisData.video.snippet.title;
            document.getElementById('analysisContent').innerHTML = `
                <div class="flex gap-4 items-center">
                    <img src="${analysisData.video.snippet.thumbnails.default.url}" class="w-24 rounded">
                    <div>
                        <p class="font-medium text-gray-800 dark:text-white">${analysisData.video.snippet.title}</p>
                        <p class="text-sm text-gray-500">${analysisData.video.snippet.channelTitle}</p>
                    </div>
                </div>
            `;
        }
    });

    async function generateStructure() {
        const topic = document.getElementById('topicInput').value.trim();
        if (!topic) {
            Utils.showToast('ì˜ìƒ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”', 'warning');
            return;
        }

        const duration = document.getElementById('durationSelect').value;
        const tone = document.getElementById('toneSelect').value;
        const notes = document.getElementById('additionalNotes').value;

        const btn = document.getElementById('generateBtn');
        Utils.setLoading(btn, true, 'ìƒì„± ì¤‘...');

        const prompt = `ë‹¹ì‹ ì€ ìœ íŠœë¸Œ ëŒ€ë³¸ ì‘ê°€ì…ë‹ˆë‹¤.
ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì˜ìƒ ëŒ€ë³¸ êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ì£¼ì„¸ìš”.

[ì˜ìƒ ì£¼ì œ]
${topic}

[ì˜ìƒ ê¸¸ì´]
${duration === 'short' ? '5-10ë¶„' : duration === 'medium' ? '10-20ë¶„' : '20ë¶„ ì´ìƒ'}

[í†¤ì•¤ë§¤ë„ˆ]
${tone}

[ì¶”ê°€ ìš”ì²­]
${notes || 'ì—†ìŒ'}

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”:

## ğŸ“Œ ì˜ìƒ ì»¨ì…‰
(ì˜ìƒì˜ í•µì‹¬ ì»¨ì…‰ 1-2ë¬¸ì¥)

## ğŸ¯ íƒ€ê²Ÿ ì‹œì²­ì
(ëˆ„êµ¬ë¥¼ ìœ„í•œ ì˜ìƒì¸ì§€)

## ğŸ“‹ ëŒ€ë³¸ êµ¬ì¡°

### 1. ì¸íŠ¸ë¡œ (0:00-0:30)
- í›„í‚¹ í¬ì¸íŠ¸:
- ì˜ìƒ ì†Œê°œ:

### 2. ë³¸ë¡  1 (0:30-3:00)
- ì£¼ì œ:
- í•µì‹¬ í¬ì¸íŠ¸:

### 3. ë³¸ë¡  2 (3:00-6:00)
- ì£¼ì œ:
- í•µì‹¬ í¬ì¸íŠ¸:

(í•„ìš”ì— ë”°ë¼ ë³¸ë¡  ì¶”ê°€)

### N. ë§ˆë¬´ë¦¬ (ë)
- ìš”ì•½:
- CTA (Call to Action):

## ğŸ’¡ í•µì‹¬ í‚¤ì›Œë“œ
(SEOìš© í‚¤ì›Œë“œ 5ê°œ)`;

        try {
            const result = await API.gemini.generate(prompt, { temperature: 0.7 });

            if (result.status === 'ok') {
                currentStructure = result.text;
                document.getElementById('structureContent').innerHTML = marked.parse(result.text);
                document.getElementById('resultSection').classList.remove('hidden');

                Utils.storage.set('scriptStructure', {
                    topic,
                    structure: result.text,
                    timestamp: Date.now()
                });
            } else {
                Utils.showToast('ìƒì„± ì‹¤íŒ¨: ' + (result.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
            }
        } catch (error) {
            console.error('ìƒì„± ì˜¤ë¥˜:', error);
            Utils.showToast('ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤', 'error');
        } finally {
            Utils.setLoading(btn, false);
        }
    }

    function copyStructure() {
        Utils.copyToClipboard(currentStructure);
        Utils.showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
    }

    function regenerate() {
        generateStructure();
    }

    function goToScriptGen() {
        window.location.href = '/script-gen';
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{% endblock %}
