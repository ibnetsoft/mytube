<!DOCTYPE html>
<html lang="ko" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - í”¼ì¹´ë””ë¦¬ìŠ¤íŠœë””ì˜¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="icon" type="image/png" href="/static/img/favicon.png">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#EF4444',
                    }
                }
            }
        }

        // ì´ˆê¸° í…Œë§ˆ ì„¤ì • (ê¸°ë³¸ê°’: Dark)
        if (localStorage.theme === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark');
        }

        function toggleTheme() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }
    </script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen">
    <div class="flex">
        <!-- ì‚¬ì´ë“œë°” -->
        <aside class="w-64 bg-white dark:bg-gray-800 min-h-screen fixed left-0 top-0 shadow-lg z-40">
            <!-- ë¡œê³  -->
            <div class="p-3 border-b border-gray-200 dark:border-gray-800">
                <a href="/" class="flex items-center gap-2">
                    <span class="text-lg font-bold text-gray-800 dark:text-white">í”¼ì¹´ë””ë¦¬ìŠ¤íŠœë””ì˜¤</span>
                </a>
            </div>

            <!-- Project Progress Header (Global) -->
            <div id="projectProgressHeader"
                class="hidden relative bg-slate-50 dark:bg-[#0f172a] border-b border-gray-200 dark:border-gray-800">
                <div class="px-4 py-3">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex flex-col">
                            <span id="currentProjectNameDisplay"
                                class="text-xs font-bold text-gray-800 dark:text-gray-100 truncate max-w-[150px]">í”„ë¡œì íŠ¸ëª…</span>
                        </div>
                        <button onclick="closeProjectContext()"
                            class="p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>

                    <!-- Progress Steps -->
                    <div class="flex justify-between items-center relative px-1">
                        <!-- Connecting Line -->
                        <div class="absolute top-[9px] left-0 right-0 h-[2px] bg-gray-200 dark:bg-gray-700 -z-0"></div>

                        <!-- Steps -->
                        <a href="/script-plan"
                            class="step-item relative z-10 flex flex-col items-center group cursor-pointer"
                            data-step="plan">
                            <div
                                class="step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors"></div>
                            </div>
                            <span class="text-[10px] mt-1 text-gray-400 font-medium transition-colors">ê¸°íš</span>
                        </a>

                        <a href="/script-gen"
                            class="step-item relative z-10 flex flex-col items-center group cursor-pointer"
                            data-step="script">
                            <div
                                class="step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors"></div>
                            </div>
                            <span class="text-[10px] mt-1 text-gray-400 font-medium transition-colors">ëŒ€ë³¸</span>
                        </a>

                        <a href="/image-gen"
                            class="step-item relative z-10 flex flex-col items-center group cursor-pointer"
                            data-step="image">
                            <div
                                class="step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors"></div>
                            </div>
                            <span class="text-[10px] mt-1 text-gray-400 font-medium transition-colors">ì´ë¯¸ì§€</span>
                        </a>

                        <a href="/tts" class="step-item relative z-10 flex flex-col items-center group cursor-pointer"
                            data-step="tts">
                            <div
                                class="step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors"></div>
                            </div>
                            <span class="text-[10px] mt-1 text-gray-400 font-medium transition-colors">TTS</span>
                        </a>

                        <a href="/subtitle-gen"
                            class="step-item relative z-10 flex flex-col items-center group cursor-pointer"
                            data-step="subtitle">
                            <div
                                class="step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors"></div>
                            </div>
                            <span class="text-[10px] mt-1 text-gray-400 font-medium transition-colors">ìë§‰</span>
                        </a>

                        <a href="/render"
                            class="step-item relative z-10 flex flex-col items-center group cursor-pointer"
                            data-step="render">
                            <div
                                class="step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300">
                                <div class="w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors"></div>
                            </div>
                            <span class="text-[10px] mt-1 text-gray-400 font-medium transition-colors">ì˜ìƒ</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- í”„ë¡œì íŠ¸ ì„ íƒ -->
            <div class="px-3 py-1.5 border-b border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-1">
                    <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400">í˜„ì¬ í”„ë¡œì íŠ¸</span>
                    <button onclick="openProjectModal()" class="text-[10px] text-blue-500 hover:text-blue-600">+
                        ìƒˆ</button>
                </div>
                <select id="projectSelect" onchange="onProjectChange(this.value)"
                    class="w-full text-sm p-2 bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 rounded-lg text-gray-800 dark:text-white">
                    <option value="">í”„ë¡œì íŠ¸ ì„ íƒ...</option>
                </select>
                <div id="currentProjectInfo" class="mt-2 text-xs text-gray-500 hidden">
                    <span id="projectStatus"></span>
                </div>
            </div>

            <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="px-2 py-1">
                <ul class="space-y-0">
                    <li>
                        <a href="/projects" class="sidebar-item {% if page == 'projects' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ“‚</span>
                            <span>ë‚´ í”„ë¡œì íŠ¸</span>
                        </a>
                    </li>
                    <li>
                        <a href="/" class="sidebar-item {% if page == 'topic' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ”</span>
                            <span>ì£¼ì œ ì°¾ê¸°</span>
                        </a>
                    </li>
                    <li>
                        <a href="/thumbnail" class="sidebar-item {% if page == 'thumbnail' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ¨</span>
                            <span>ì¸ë„¤ì¼ ìƒì„±</span>
                        </a>
                    </li>
                    <li>
                        <a href="/script-plan" class="sidebar-item {% if page == 'script-plan' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ“‹</span>
                            <span>ëŒ€ë³¸ ê¸°íš</span>
                        </a>
                    </li>
                    <li>
                        <a href="/script-gen" class="sidebar-item {% if page == 'script-gen' %}active{% endif %}">
                            <span class="sidebar-icon">âœï¸</span>
                            <span>ëŒ€ë³¸ ìƒì„±</span>
                        </a>
                    </li>
                    <li>
                        <a href="/video-gen" class="sidebar-item {% if page == 'video-gen' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ¥</span>
                            <span>ì¸íŠ¸ë¡œ ìƒì„±</span>
                        </a>
                    </li>
                    <li>
                        <a href="/image-gen" class="sidebar-item {% if page == 'image-gen' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ–¼ï¸</span>
                            <span>ì´ë¯¸ì§€ ìƒì„±</span>
                        </a>
                    </li>
                    <li>
                        <a href="/tts" class="sidebar-item {% if page == 'tts' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ”Š</span>
                            <span>TTS ìƒì„±</span>
                        </a>
                    </li>
                    <li>
                        <a href="/music-gen" class="sidebar-item {% if page == 'music-gen' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸµ</span>
                            <span>ë°°ê²½ìŒì•… ìƒì„±</span>
                        </a>
                    </li>
                    <li>
                        <a href="/subtitle-gen" class="sidebar-item {% if page == 'subtitle-gen' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ“</span>
                            <span>ìë§‰ í¸ì§‘</span>
                        </a>
                    </li>
                    <li>
                        <a href="/render" class="sidebar-item {% if page == 'render' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ¬</span>
                            <span>ì˜ìƒ ë Œë”ë§</span>
                        </a>
                    </li>
                    <li>
                        <a href="/video-upload" class="sidebar-item {% if page == 'video-upload' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ“¤</span>
                            <span>ì˜ìƒ ì—…ë¡œë“œ</span>
                        </a>
                    </li>
                    <li>
                        <a href="/title-desc" class="sidebar-item {% if page == 'title-desc' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ“</span>
                            <span>ì œëª©/ì„¤ëª… ìƒì„±</span>
                        </a>
                    </li>

                    <li>
                        <a href="/shorts" class="sidebar-item {% if page == 'shorts' %}active{% endif %}">
                            <span class="sidebar-icon">ğŸ“±</span>
                            <span>ì‡¼ì¸  ìƒì„±</span>
                        </a>
                    </li>
                    <li class="mt-1 pt-1">
                        <a href="/settings" class="sidebar-item {% if page == 'settings' %}active{% endif %}">
                            <span class="sidebar-icon">âš™ï¸</span>
                            <span>ì„¤ì •</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="px-3 pb-1">
                <button onclick="toggleTheme()"
                    class="w-full flex items-center justify-center gap-2 p-1 rounded-lg bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-[10px] font-medium">
                    <span class="dark:hidden">ğŸŒ ë¼ì´íŠ¸</span>
                    <span class="hidden dark:inline">ğŸŒ™ ë‹¤í¬</span>
                </button>
            </div>
    </div>

    <!-- API ìƒíƒœ -->
    <div class="absolute bottom-0 left-0 right-0 p-4">
        <div id="apiStatus" class="text-xs text-gray-500 dark:text-gray-400">
            <div class="flex items-center gap-2 mb-1">
                <span id="statusDot" class="w-2 h-2 rounded-full bg-gray-400"></span>
                <span>API ìƒíƒœ í™•ì¸ ì¤‘...</span>
            </div>
        </div>
    </div>
    </aside>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <main class="flex-1 ml-64 p-6">
        {% block content %}{% endblock %}
    </main>
    </div>

    <!-- í”„ë¡œì íŠ¸ ìƒì„± ëª¨ë‹¬ -->
    <div id="projectModal" class="modal-overlay hidden">
        <div class="modal-content max-w-md">
            <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">ìƒˆ í”„ë¡œì íŠ¸ ë§Œë“¤ê¸°</h3>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">í”„ë¡œì íŠ¸ ì´ë¦„</label>
                    <input type="text" id="newProjectName" class="input-field" placeholder="ì˜ˆ: ì‚¼êµ­ì§€ ì˜ìƒ ì‹œë¦¬ì¦ˆ">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ì£¼ì œ (ì„ íƒ)</label>
                    <input type="text" id="newProjectTopic" class="input-field" placeholder="ì˜ˆ: ì‚¼êµ­ì§€ ì¸ë¬¼ ë¶„ì„">
                </div>
                <div class="flex gap-3">
                    <button onclick="createNewProject()" class="flex-1 btn-primary">ìƒì„±</button>
                    <button onclick="closeProjectModal()" class="btn-secondary">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ê³µí†µ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/static/js/api.js?v=2"></script>
    <script src="/static/js/utils.js?v=3"></script>
    {% block scripts %}{% endblock %}

    <script>
        // í”„ë¡œì íŠ¸ ìƒíƒœ í•œê¸€
        const statusLabels = {
            'draft': 'ì‹œì‘',
            'analyzed': 'ë¶„ì„ ì™„ë£Œ',
            'planned': 'ê¸°íš ì™„ë£Œ',
            'scripted': 'ëŒ€ë³¸ ì™„ë£Œ',
            'tts_done': 'TTS ì™„ë£Œ',
            'rendered': 'ë Œë”ë§ ì™„ë£Œ',
            'completed': 'ì™„ë£Œ'
        };

        // í”„ë¡œì íŠ¸ ëª©ë¡ ë¡œë“œ
        async function loadProjects() {
            try {
                const data = await API.project.list();
                const select = document.getElementById('projectSelect');
                const currentId = getCurrentProject();

                select.innerHTML = '<option value="">í”„ë¡œì íŠ¸ ì„ íƒ...</option>';

                data.projects.forEach(p => {
                    const option = document.createElement('option');
                    option.value = p.id;
                    option.textContent = `${p.name} (${statusLabels[p.status] || p.status})`;
                    if (p.id == currentId) option.selected = true;
                    select.appendChild(option);
                });

                // í˜„ì¬ í”„ë¡œì íŠ¸ ì •ë³´ í‘œì‹œ ë° ì „ì²´ ìƒíƒœ ë³µêµ¬
                if (currentId) {
                    // onProjectChangeë¥¼ í˜¸ì¶œí•˜ì—¬ í—¤ë”, ì§„í–‰ìƒíƒœ, ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ë“±ì„ ëª¨ë‘ ë³µêµ¬
                    onProjectChange(currentId);
                }
            } catch (e) {
                console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì˜¤ë¥˜:', e);
            }
        }

        // í”„ë¡œì íŠ¸ ì •ë³´ ì—…ë°ì´íŠ¸
        function updateProjectInfo(project) {
            const infoDiv = document.getElementById('currentProjectInfo');
            const statusSpan = document.getElementById('projectStatus');

            if (project) {
                infoDiv.classList.remove('hidden');
                statusSpan.textContent = `ìƒíƒœ: ${statusLabels[project.status] || project.status}`;
            } else {
                infoDiv.classList.add('hidden');
            }
        }

        // í”„ë¡œì íŠ¸ ë³€ê²½
        async function onProjectChange(projectId) {
            if (projectId) {
                // 1. UI ë° ë¡œì»¬ ìƒíƒœ ê¸°ë³¸ ì—…ë°ì´íŠ¸
                setCurrentProject(projectId);

                // Select Box ì—…ë°ì´íŠ¸ (í”„ë¡œê·¸ë¨ì  í˜¸ì¶œ ì‹œ í•„ìš”)
                const selectElement = document.getElementById('projectSelect');
                if (selectElement && selectElement.value != projectId) {
                    selectElement.value = projectId;
                }

                // 2. í”„ë¡œì íŠ¸ ê¸°ë³¸ ì •ë³´ ì¡°íšŒ ë° í‘œì‹œ
                try {
                    const project = await API.project.get(projectId);
                    updateProjectInfo(project);

                    // Header Display Update
                    const headerDisplay = document.getElementById('currentProjectNameDisplay');
                    if (headerDisplay) {
                        const statusText = statusLabels[project.status] || project.status;
                        headerDisplay.textContent = `${project.name} (${statusText})`;
                        document.getElementById('projectProgressHeader').classList.remove('hidden');
                    }

                    Utils.showToast(`í”„ë¡œì íŠ¸ "${project.name}" ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...`, 'info');

                    // 3. âœ¨ ì „ì²´ ë°ì´í„° ë™ê¸°í™” (Context Switching í•µì‹¬) âœ¨
                    const fullData = await API.project.getFull(projectId);

                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ê° ë‹¨ê³„ ë°ì´í„° ì—…ë°ì´íŠ¸
                    if (fullData) {
                        // ëŒ€ë³¸ ê¸°íš
                        if (fullData.script_structure) Utils.storage.set('scriptStructure', fullData.script_structure);
                        // ëŒ€ë³¸ 
                        if (fullData.script) Utils.storage.set('fullScript', fullData.script);
                        // ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ (image_gen.htmlìš©)
                        if (fullData.image_prompts) Utils.storage.set('imagePrompts', fullData.image_prompts);

                        // ì´ë²¤íŠ¸ ë°œìƒ (í˜„ì¬ í˜ì´ì§€ê°€ ë¦¬ìŠ¤ë‹ ì¤‘ì´ë¼ë©´ ì¦‰ì‹œ ë°˜ì˜)
                        window.dispatchEvent(new CustomEvent('projectStateRestored', { detail: fullData }));

                        // âœ¨ UI ì§„í–‰ ìƒíƒœ ì—…ë°ì´íŠ¸ (Green Light)
                        // ì‚¬ìš©ì ìš”ì²­: ê° ë‹¨ê³„ë³„ ì‹¤ì œ ë°ì´í„° ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸ (Strict Mode)
                        const steps = {
                            'plan': !!fullData.script_structure, // ê¸°íš ë°ì´í„°ê°€ ìˆì–´ì•¼ë§Œ Green
                            'script': !!fullData.script,         // ëŒ€ë³¸ ë°ì´í„°ê°€ ìˆì–´ì•¼ë§Œ Green
                            'image': fullData.image_prompts?.length > 0,
                            'tts': !!fullData.tts,
                            'subtitle': !!fullData.tts, // ì„ì‹œ: TTSì™€ ì—°ë™
                            'render': project.status === 'rendered' || project.status === 'completed'
                        };

                        document.querySelectorAll('.step-item').forEach(el => {
                            const stepName = el.dataset.step;
                            const circle = el.querySelector('.step-circle');
                            const indicator = el.querySelector('.step-circle div');
                            const label = el.querySelector('span');

                            // Reset
                            circle.className = 'step-circle w-5 h-5 rounded-full bg-gray-200 dark:bg-gray-700 border-2 border-white dark:border-gray-800 flex items-center justify-center transition-all duration-300';
                            indicator.className = 'w-1.5 h-1.5 rounded-full bg-gray-400 transition-colors';
                            label.classList.remove('text-green-500', 'font-bold');
                            label.classList.add('text-gray-400');

                            if (steps[stepName]) {
                                // Completed Style
                                circle.classList.remove('bg-gray-200', 'dark:bg-gray-700');
                                circle.classList.add('bg-green-500', 'border-green-500', 'dark:bg-green-500', 'dark:border-green-500');

                                indicator.className = 'w-2 h-1.5 text-white'; // Checkmark logic optional or just white dot
                                indicator.innerHTML = `<svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path></svg>`;
                                indicator.classList.remove('rounded-full', 'bg-gray-400', 'w-1.5', 'h-1.5'); // Remove dot styles

                                label.classList.remove('text-gray-400');
                                label.classList.add('text-green-600', 'dark:text-green-400', 'font-bold');
                            }
                        });


                        Utils.showToast(`"${project.name}" ë°ì´í„° ë¡œë“œ ì™„ë£Œ`, 'success');
                    }

                } catch (e) {
                    console.error("í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨", e);
                    Utils.showToast('í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
                }

            } else {
                setCurrentProject(null);
                document.getElementById('currentProjectInfo').classList.add('hidden');
                document.getElementById('projectProgressHeader').classList.add('hidden');

                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„°ë„ ë¹„ìš°ëŠ” ê²ƒì´ ì¢‹ìŒ (ì„ íƒ í•´ì œ ì‹œ)
                Utils.storage.remove('scriptStructure');
                Utils.storage.remove('fullScript');
                Utils.storage.remove('imagePrompts');
            }
        }


        // í”„ë¡œì íŠ¸ ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
        function openProjectModal() {
            document.getElementById('projectModal').classList.remove('hidden');
            document.getElementById('projectModal').classList.add('flex');
            document.getElementById('newProjectName').focus();
        }

        function closeProjectModal() {
            document.getElementById('projectModal').classList.add('hidden');
            document.getElementById('projectModal').classList.remove('flex');
            document.getElementById('newProjectName').value = '';
            document.getElementById('newProjectTopic').value = '';
        }

        // ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
        async function createNewProject() {
            const name = document.getElementById('newProjectName').value.trim();
            const topic = document.getElementById('newProjectTopic').value.trim();

            if (!name) {
                Utils.showToast('í”„ë¡œì íŠ¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”', 'warning');
                return;
            }

            try {
                const result = await API.project.create(name, topic || null);
                if (result.project_id) {
                    setCurrentProject(result.project_id);
                    closeProjectModal();
                    await loadProjects();
                    Utils.showToast('í”„ë¡œì íŠ¸ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤', 'success');
                }
            } catch (e) {
                Utils.showToast('í”„ë¡œì íŠ¸ ìƒì„± ì‹¤íŒ¨', 'error');
            }
        }

        // API ìƒíƒœ í™•ì¸
        async function checkApiStatus() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                const statusDot = document.getElementById('statusDot');
                const apiStatus = document.getElementById('apiStatus');

                if (data.status === 'ok') {
                    const activeApis = Object.entries(data.apis)
                        .filter(([k, v]) => v)
                        .map(([k]) => k);

                    statusDot.className = 'w-2 h-2 rounded-full bg-green-500';
                    apiStatus.innerHTML = `
                        <div class="flex items-center gap-2 mb-1">
                            <span class="w-2 h-2 rounded-full bg-green-500"></span>
                            <span class="text-green-600 dark:text-green-400">ì—°ê²°ë¨</span>
                        </div>
                        <div class="text-gray-400">${activeApis.join(', ')}</div>
                    `;
                }
            } catch (e) {
                document.getElementById('statusDot').className = 'w-2 h-2 rounded-full bg-red-500';
            }
        }

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeProjectModal();
        });

        // ì´ˆê¸°í™”
        loadProjects();
        checkApiStatus();
    </script>
</body>

</html>